import numpy as np
import random
import matplotlib.pyplot as plt

# --- Environment Settings ---
GRID_SIZE = 5
ACTIONS = 4  # up, down, left, right
EPISODES = 500

# Q-table
Q = np.zeros((GRID_SIZE, GRID_SIZE, ACTIONS))

# Hyperparameters
alpha = 0.1      # learning rate
gamma = 0.9      # discount factor
epsilon = 1.0    # exploration rate
epsilon_decay = 0.995
epsilon_min = 0.01

start = (0, 0)
goal = (4, 4)

# --- Step Function ---
def step(state, action):
    x, y = state

    if action == 0: x = max(x - 1, 0)        # up
    if action == 1: x = min(x + 1, GRID_SIZE - 1)  # down
    if action == 2: y = max(y - 1, 0)        # left
    if action == 3: y = min(y + 1, GRID_SIZE - 1)  # right

    reward = -0.01
    done = False

    if (x, y) == goal:
        reward = 1
        done = True

    return (x, y), reward, done

# --- Training ---
steps_per_episode = []

for episode in range(EPISODES):
    state = start
    steps = 0
    done = False

    while not done:
        if random.random() < epsilon:
            action = random.randint(0, ACTIONS - 1)
        else:
            action = np.argmax(Q[state])

        next_state, reward, done = step(state, action)

        Q[state][action] += alpha * (
            reward + gamma * np.max(Q[next_state]) - Q[state][action]
        )

        state = next_state
        steps += 1

    steps_per_episode.append(steps)

    if epsilon > epsilon_min:
        epsilon *= epsilon_decay

# --- Plot Learning Curve ---
plt.figure()
plt.plot(steps_per_episode)
plt.xlabel("Episode")
plt.ylabel("Steps to Reach Goal")
plt.title("Q-Learning Training Progress")
plt.show()
